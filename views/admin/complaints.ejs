<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Complaints - Admin</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <style>
    .admin-complaints { padding: var(--space-8) 0; }
    .admin-header {
      margin-bottom: var(--space-8);
      padding-bottom: var(--space-6);
      border-bottom: 1px solid var(--border-light);
    }
    .admin-header h1 {
      font-family: 'Poppins', sans-serif;
      font-size: var(--text-4xl);
      font-weight: var(--font-black);
      color: var(--text-primary);
      margin-bottom: var(--space-2);
    }
    .admin-table-container {
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-2xl);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
    }
    table { 
      width: 100%; 
      border-collapse: collapse; 
      font-size: var(--text-sm);
    }
    thead {
      background: var(--bg-secondary);
    }
    th, td { 
      padding: var(--space-4); 
      border-bottom: 1px solid var(--border-light); 
      text-align: left; 
    }
    th { 
      font-family: 'Poppins', sans-serif;
      font-weight: var(--font-semibold);
      color: var(--text-primary);
      font-size: var(--text-sm);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    tbody tr {
      transition: background var(--transition-fast);
    }
    tbody tr:hover {
      background: var(--bg-secondary);
    }
    .status { 
      padding: var(--space-1) var(--space-3); 
      border-radius: var(--radius-full); 
      border: 1px solid var(--border-medium);
      font-size: var(--text-xs);
      font-weight: var(--font-semibold);
      display: inline-block;
    }
    .status.open {
      background: var(--warning-50);
      color: var(--warning-700);
      border-color: var(--warning-300);
    }
    .status.in_progress {
      background: var(--primary-50);
      color: var(--primary-700);
      border-color: var(--primary-300);
    }
    .status.resolved {
      background: var(--success-50);
      color: var(--success-700);
      border-color: var(--success-300);
    }
    .actions { 
      display: flex; 
      gap: var(--space-2); 
      align-items: center;
    }
    .actions form { 
      display: inline-flex;
      gap: var(--space-2);
      align-items: center;
    }
    .actions select {
      padding: var(--space-2) var(--space-3);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: var(--text-sm);
    }
    .actions select:focus {
      outline: none;
      border-color: var(--primary-300);
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
    }
    .actions button {
      padding: var(--space-2) var(--space-4);
      font-size: var(--text-xs);
    }
    .attachment-link {
      color: var(--primary-600);
      text-decoration: none;
      font-weight: var(--font-semibold);
      transition: color var(--transition-fast);
    }
    .attachment-link:hover {
      color: var(--primary-700);
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <nav class="navbar" id="navbar">
    <div class="container nav-container">
      <a href="/" class="logo">
        <img src="/css/images/logo.jpg" alt="College FMS Logo">
        <span>College FMS</span>
      </a>
      <ul class="nav-links">
        <li><a href="/admin">Dashboard</a></li>
        <li><a href="/admin/complaints">Complaints</a></li>
        <li><a href="/admin/feedbacks">Feedback</a></li>
        <li><a href="/logout" class="btn btn-sm btn-ghost">Logout</a></li>
      </ul>
    </div>
  </nav>
  <div class="container admin-complaints">
    <div class="admin-header">
      <h1>Complaints Management</h1>
      <p style="color: var(--text-secondary);">Manage and track all submitted complaints</p>
    </div>
    <div class="admin-table-container">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Submitted</th>
          <th>Name</th>
          <th>Email</th>
          <th>Category</th>
          <th>Location</th>
          <th>Subject</th>
          <th>Status</th>
          <th>Attachment</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% complaints.forEach(c => { %>
          <tr>
            <td><%= c.id %></td>
            <td><%= new Date(c.createdAt).toLocaleString() %></td>
            <td><%= c.name %></td>
            <td><%= c.email %></td>
            <td><%= c.category %></td>
            <td><%= c.location %></td>
            <td><%= c.subject %></td>
            <td><span class="status <%= c.status %>"><%= c.status.replace('_', ' ') %></span></td>
            <td>
              <% if (c.attachmentUrl) { %>
                <a href="<%= c.attachmentUrl %>" target="_blank" class="attachment-link">View</a>
              <% } else { %>
                <span style="color: var(--text-tertiary);">-</span>
              <% } %>
            </td>
            <td class="actions">
              <form method="POST" action="/admin/complaints/<%= c.id %>/status" style="display: inline;">
                <select name="status">
                  <option value="open" <%= c.status==='open'?'selected':'' %>>Open</option>
                  <option value="in_progress" <%= c.status==='in_progress'?'selected':'' %>>In Progress</option>
                  <option value="resolved" <%= c.status==='resolved'?'selected':'' %>>Resolved</option>
                </select>
                <button type="submit" class="btn btn-sm btn-primary">Update</button>
              </form>
              <form method="POST" action="/admin/complaints/<%= c.id %>/delete" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this complaint? This action cannot be undone.');">
                <button type="submit" class="btn btn-sm" style="background: var(--error-600); color: white; margin-left: var(--space-2);">Delete</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
    </div>
  </div>

  <footer>
    <div class="container">
      <div class="footer-bottom">
        <p>&copy; 2025 College Facilities & Management System. All rights reserved. Built for education.</p>
      </div>
    </div>
  </footer>

  <script>
    lucide.createIcons();
    window.addEventListener('scroll', () => {
      const navbar = document.getElementById('navbar');
      if (window.scrollY > 50) {
        navbar.classList.add('scrolled');
      } else {
        navbar.classList.remove('scrolled');
      }
    });
  </script>
</body>
</html>

